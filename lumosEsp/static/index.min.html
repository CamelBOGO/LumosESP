<!DOCTYPE html>  <head> <link href="./css/pico.indigo.min.css" rel="stylesheet"> <title>LumosESP</title> <meta charset="UTF-8"> <link rel="icon" href="data:,"> <meta name="viewport" content="width=device-width,initial-scale=1"> <style>@media (prefers-color-scheme:light){.gradient_header{background:linear-gradient(to right,#c33764,#952bff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}}@media (prefers-color-scheme:dark){.gradient_header{background:linear-gradient(to right,#c33764,#952bff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}}</style> </head> <body> <div style="display:flex;justify-content:center"> <h1 class="gradient_header" style="text-align:center;margin:16px 0 0">LumosESP</h1> <hr> </div> <hr> <div id="selectColour" class="container-fluid" style="max-width:768px"> <form> <label for="selectColour">Select a colour:</label> <select id="selectColour" onchange="putColour(event.target.value)"> <option selected value="0x000000">Off</option> <option value="0xFFFFFF">White</option> <option value="0xFF0000">Red</option> <option value="0xFFA500">Orange</option> <option value="0xFFD700">Gold</option> <option value="0xFFFF00">Yellow</option> <option value="0x00FF00">Green</option> <option value="0x00FFFF">Cyan</option> <option value="0x0000FF">Blue</option> <option value="0xA13DFF">BlueViolet</option> <option value="0xFF00FF">Magenta</option> <option value="0xFFC0CB">Pink</option> <option value="cycle">Cycle</option> <option value="rainbow">Rainbow</option> </select> </form> <h6>Current Colour:</h6> <p id="currentColour">N/A</p> <h6>WiFi Status:</h6> <p id="wifiStatus">N/A</p> <p id="ipAddress">N/A</p> <button id="turnOffApBtn" onclick="turnOffAp()" style="width:100%;display:none">Turn Off AP</button> <div id="wifiFormDiv"> <h6>WiFi Configuration</h6> <form id="wifiForm" autocomplete="off"> <fieldset> <input name="login" placeholder="SSID"> <input type="password" name="password" placeholder="Password"> <button type="submit">Submit</button> </fieldset> </form> </div> </div>  <script>function decToHexColour(e){return"#"+e.toString(16).padStart(6,"0")}function setColourText(e){document.getElementById("currentColour").innerText="cycle"===e?"Cycle":"rainbow"===e?"Rainbow":decToHexColour(e)}function setSelectedColour(e){}function setWifiStatusText(e,t){console.log("WiFi mode:",e);let o=document.getElementById("wifiStatus"),r=document.getElementById("ipAddress"),n=document.getElementById("turnOffApBtn"),i=document.getElementById("wifiFormDiv");switch(e){case 0:o.innerText="AP Mode";break;case 1:o.innerText="WiFi Mode",r.innerHTML=`<a href="http://${t}">http://${t}</a>`,i.style.display="none";break;case 2:o.innerText="AP/WiFi Mode (Turn off AP to save power)",r.innerHTML=`<a href="http://${t}">http://${t}</a>`,n.style.display="",i.style.display="none";break;default:o.innerText="Invalid Mode"}}async function getCurrentColour(){try{const e=await fetch("/api/led");if(!e.ok)return void console.error("Failed to fetch LED colour");const t=await e.json();t.led?(setColourText(t.led),setSelectedColour(t.led)):console.error("Invalid response from server.")}catch(e){console.error("An error occurred:",e)}}async function putColour(e){try{e.toString().startsWith("0x")&&(e=parseInt(e,16));const t=await fetch("/api/led",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({led:e})});if(200!==t.status)return void console.error("Failed to change LED colour");const o=await t.json();o.led?setColourText(o.led):console.error("Invalid response from server.")}catch(e){console.error("An error occurred:",e)}}async function getWifiStatus(){try{const e=await fetch("/api/wifi");if(!e.ok)return void console.error("Failed to fetch WiFi status");const t=await e.json();setWifiStatusText(t.mode,t.ip)}catch(e){console.error("An error occurred:",e)}}async function handleWifiSubmit(e){e.preventDefault();try{const t=new FormData(e.target),o=await fetch("/api/wifi",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({ssid:t.get("login"),password:t.get("password")})});if(200!==o.status)return void console.error("Failed to change WiFi configuration");const r=await o.json();document.getElementById("wifiStatus").style.color="red",document.getElementById("wifiStatus").innerHTML=`\n                    You have submitted the WiFi config to ESP. If the password is correct, it will connect to the WiFi.\n                    Refresh the page after a few seconds to see the IP address.\n                    Use the address <a href="http://${r.host}.local">http://${r.host}.local</a> to access the ESP via the same WiFi network.\n                    Android phone may not support mDNS, so you may need to use the IP address to access the ESP.\n                    The IP address is assigned by the router, so you need to check the router's DHCP client list.\n                    It may look like <a href="http://${r.ip}">${r.ip}</a>.\n                `}catch(e){console.error("An error occurred:",e)}}async function turnOffAp(){try{const e=await fetch("/api/network_mode",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:1})});if(200!==e.status)return void console.error("Failed to turn off AP");setWifiStatusText((await e.json()).mode,"0.0.0.0")}catch(e){console.error("An error occurred:",e)}}document.getElementById("wifiForm").addEventListener("submit",handleWifiSubmit),getCurrentColour(),getWifiStatus()</script> 