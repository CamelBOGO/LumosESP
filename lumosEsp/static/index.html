<!DOCTYPE html>
<html>
    <head>
        <link href="./css/pico.indigo.min.css" rel="stylesheet" />

        <title>LumosESP</title>
        <meta charset="UTF-8" />
        <link rel="icon" href="data:," />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>
    <body>
        <!-- The Title of The Website -->
        <div style="display: flex; justify-content: center">
            <h1
                style="
                    text-align: center;
                    margin: 16px 0px 0px;
                    background: linear-gradient(
                        to right,
                        #ef5350,
                        #f48fb1,
                        #7e57c2,
                        #2196f3,
                        #26c6da,
                        #43a047,
                        #eeff41,
                        #f9a825,
                        #ff5722
                    );
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                ">
                LumosESP
            </h1>
            <hr />
        </div>
        <hr />

        <!-- The Form of Colour Selection -->
        <div id="selectColour" class="container-fluid" style="max-width: 768px">
            <form>
                <label for="selectColour">Select a colour:</label>
                <select id="selectColour">
                    <option selected value="off">Off</option>
                    <option value="red">Red</option>
                    <option value="green">Green</option>
                    <option value="blue">Blue</option>
                    <option value="white">White</option>
                </select>
            </form>

            <!-- The Text of Current Colour -->
            <p>Current Colour:</p>
            <p id="currentColour">N/A</p>

            <!-- WiFi Status -->
            <p>WiFi Status:</p>
            <p id="wifiStatus">N/A</p>
        </div>
    </body>

    <!-- Script Here -->
    <script>
        function decToHexColour(dec) {
            return "#" + dec.toString(16).padStart(6, "0");
        }

        async function setColourText() {
            try {
                // Fetch the current LED colour.
                const response = await fetch("/api/led");

                // Check if the response was successful.
                if (!response.ok) {
                    console.error("Failed to fetch LED colour");
                    return;
                }

                // Parse the response JSON.
                const data = await response.json();

                // Set the current colour text.
                if (data.led) {
                    document.getElementById("currentColour").innerText = decToHexColour(data.led);
                } else {
                    console.error("Invalid response from server.");
                }
            } catch (error) {
                console.error("An error occurred:", error);
            }
        }

        async function putColour(colour) {
            try {
                // Send a PUT request to the server to change the LED colour.
                const response = await fetch("/api/led", {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ led: colour }),
                });

                // Check if the response was successful.
                if (response.status !== 200) {
                    console.error("Failed to change LED colour");
                    return;
                }

                const data = await response.json();

                // Set the current colour text.
                if (data.led) {
                    document.getElementById("currentColour").innerText = decToHexColour(data.led);
                } else {
                    console.error("Invalid response from server.");
                }
            } catch (error) {
                console.error("An error occurred:", error);
            }
        }

        async function getWifiStatus() {
            try {
                // Fetch the current WiFi status.
                const response = await fetch("/api/wifi");

                // Check if the response was successful.
                if (!response.ok) {
                    console.error("Failed to fetch WiFi status");
                    return;
                }

                // Parse the response JSON.
                const data = await response.json();

                // Set the current WiFi status text.
                if (data.mode == 0) {
                    document.getElementById("wifiStatus").innerText = "AP Mode";
                } else {
                    document.getElementById("wifiStatus").innerText = "WiFi Mode";
                }
            } catch (error) {
                console.error("An error occurred:", error);
            }
        }

        // Main Script
        document.getElementById("selectColour").addEventListener("change", function (event) {
            console.log(event.target.value);
            putColour(event.target.value);
        });

        setColourText();
        getWifiStatus();
    </script>
</html>
